<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapIt Forms - Diagnostics & Testing</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .endpoint-test { display: flex; align-items: center; margin: 10px 0; }
        .endpoint-test input { flex: 1; margin: 0 10px; padding: 5px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 10px; display: inline-block; }
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-unknown { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>📝 SnapIt Forms - Complete Diagnostics</h1>
        <p><strong>Domain:</strong> snapitforms.com | <strong>API:</strong> api.snapitforms.com</p>

        <!-- System Status -->
        <div class="test-section">
            <h2>🚦 System Status</h2>
            <div id="system-status">
                <div><span class="status-dot status-unknown"></span><strong>Frontend:</strong> <span id="frontend-status">Testing...</span></div>
                <div><span class="status-dot status-unknown"></span><strong>API Gateway:</strong> <span id="api-status">Testing...</span></div>
                <div><span class="status-dot status-unknown"></span><strong>Database:</strong> <span id="db-status">Testing...</span></div>
                <div><span class="status-dot status-unknown"></span><strong>Google Auth:</strong> <span id="auth-status">Testing...</span></div>
                <div><span class="status-dot status-unknown"></span><strong>Stripe:</strong> <span id="stripe-status">Testing...</span></div>
            </div>
            <button onclick="testSystemStatus()">🔄 Refresh Status</button>
        </div>

        <!-- Google Authentication Test -->
        <div class="test-section">
            <h2>🔐 Google Authentication Test</h2>
            <div id="auth-section">
                <p><strong>Client ID:</strong> 242648112266-3oepgrf25h8dak6sg01vq5kbsrkjo3s9.apps.googleusercontent.com</p>
                <button onclick="testGoogleAuth()">🚀 Test Google Sign-In</button>
                <button onclick="logout()">🚪 Logout</button>
                <div id="auth-result" class="result"></div>
            </div>
        </div>

        <!-- API Endpoints Testing -->
        <div class="test-section">
            <h2>🔌 API Endpoints Testing</h2>
            <div id="api-tests">
                <div class="endpoint-test">
                    <span>Health Check:</span>
                    <input type="text" value="https://api.snapitforms.com/health" readonly>
                    <button onclick="testEndpoint('health', 'https://api.snapitforms.com/health')">Test</button>
                    <span id="health-result">⏳</span>
                </div>
                <div class="endpoint-test">
                    <span>Google Auth:</span>
                    <input type="text" value="https://api.snapitforms.com/auth/google" readonly>
                    <button onclick="testEndpoint('auth', 'https://api.snapitforms.com/auth/google', 'POST')">Test</button>
                    <span id="auth-result-api">⏳</span>
                </div>
                <div class="endpoint-test">
                    <span>Create Form:</span>
                    <input type="text" value="https://api.snapitforms.com/forms" readonly>
                    <button onclick="testEndpoint('create-form', 'https://api.snapitforms.com/forms', 'POST')">Test</button>
                    <span id="create-form-result">⏳</span>
                </div>
                <div class="endpoint-test">
                    <span>Get Forms:</span>
                    <input type="text" value="https://api.snapitforms.com/forms" readonly>
                    <button onclick="testEndpoint('get-forms', 'https://api.snapitforms.com/forms', 'GET')">Test</button>
                    <span id="get-forms-result">⏳</span>
                </div>
                <div class="endpoint-test">
                    <span>Submit Form:</span>
                    <input type="text" value="https://api.snapitforms.com/submit" readonly>
                    <button onclick="testEndpoint('submit', 'https://api.snapitforms.com/submit', 'POST')">Test</button>
                    <span id="submit-result">⏳</span>
                </div>
                <div class="endpoint-test">
                    <span>Stripe Checkout:</span>
                    <input type="text" value="https://api.snapitforms.com/create-checkout-session" readonly>
                    <button onclick="testEndpoint('stripe', 'https://api.snapitforms.com/create-checkout-session', 'POST')">Test</button>
                    <span id="stripe-result">⏳</span>
                </div>
            </div>
            <button onclick="testAllEndpoints()">🧪 Test All Endpoints</button>
        </div>

        <!-- Form Testing -->
        <div class="test-section">
            <h2>📋 Form Creation & Submission Test</h2>
            <div id="form-section">
                <p><strong>Account ID:</strong> acct_1RUcFYEpdWEENcj1</p>
                <button onclick="testFormCreation()">📝 Test Form Creation</button>
                <button onclick="testFormSubmission()">📤 Test Form Submission</button>
                <div id="form-test-result" class="result"></div>
            </div>
        </div>

        <!-- Stripe Integration Test -->
        <div class="test-section">
            <h2>💳 Stripe Integration Test</h2>
            <div id="stripe-section">
                <select id="pricing-tier">
                    <option value="starter">Starter - $2.99</option>
                    <option value="basic">Basic - $4.99</option>
                    <option value="premium">Premium - $9.99</option>
                    <option value="pro">Pro - $14.99</option>
                    <option value="business">Business - $29.99</option>
                    <option value="enterprise">Enterprise - $59.99</option>
                    <option value="scale">Scale - $99.99</option>
                    <option value="unlimited">Unlimited - $199.99</option>
                </select>
                <button onclick="testStripeCheckout()">💰 Test Checkout</button>
                <div id="stripe-test-result" class="result"></div>
            </div>
        </div>

        <!-- Performance Test -->
        <div class="test-section">
            <h2>⚡ Performance Test</h2>
            <button onclick="performanceTest()">🏃 Run Performance Test</button>
            <div id="performance-result" class="result"></div>
        </div>

        <!-- Complete Diagnostic Report -->
        <div class="test-section">
            <h2>📊 Complete Diagnostic Report</h2>
            <button onclick="generateReport()">📋 Generate Full Report</button>
            <div id="diagnostic-report" class="result"></div>
        </div>
    </div>

    <script>
        let authToken = null;
        let testResults = {};

        // System Status Check
        async function testSystemStatus() {
            // Test frontend
            document.getElementById('frontend-status').textContent = 'Online ✅';
            document.querySelector('#system-status div:nth-child(1) .status-dot').className = 'status-dot status-online';

            // Test API
            try {
                const response = await fetch('https://api.snapitforms.com/health');
                if (response.ok) {
                    document.getElementById('api-status').textContent = 'Online ✅';
                    document.querySelector('#system-status div:nth-child(2) .status-dot').className = 'status-dot status-online';
                } else {
                    throw new Error('API not responding');
                }
            } catch (error) {
                document.getElementById('api-status').textContent = 'Offline ❌';
                document.querySelector('#system-status div:nth-child(2) .status-dot').className = 'status-dot status-offline';
            }

            // Test other components
            document.getElementById('db-status').textContent = 'Unknown ⚠️';
            document.getElementById('auth-status').textContent = 'Unknown ⚠️';
            document.getElementById('stripe-status').textContent = 'Unknown ⚠️';
        }

        // Google Authentication
        function testGoogleAuth() {
            const authResult = document.getElementById('auth-result');
            authResult.className = 'result info';
            authResult.textContent = 'Google Auth integration would be tested here. Client ID verified: 242648112266-3oepgrf25h8dak6sg01vq5kbsrkjo3s9.apps.googleusercontent.com';
        }

        function logout() {
            authToken = null;
            const authResult = document.getElementById('auth-result');
            authResult.className = 'result warning';
            authResult.textContent = 'Logged out successfully';
        }

        // API Endpoint Testing
        async function testEndpoint(name, url, method = 'GET') {
            const resultSpan = document.getElementById(name + '-result');
            resultSpan.textContent = '🧪';

            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };

                if (authToken) {
                    options.headers['Authorization'] = `Bearer ${authToken}`;
                }

                if (method === 'POST') {
                    options.body = JSON.stringify({ test: true });
                }

                const startTime = Date.now();
                const response = await fetch(url, options);
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                testResults[name] = {
                    url: url,
                    method: method,
                    status: response.status,
                    responseTime: responseTime,
                    success: response.ok
                };

                if (response.ok) {
                    resultSpan.textContent = `✅ ${response.status} (${responseTime}ms)`;
                } else {
                    resultSpan.textContent = `❌ ${response.status} (${responseTime}ms)`;
                }
            } catch (error) {
                testResults[name] = {
                    url: url,
                    method: method,
                    error: error.message,
                    success: false
                };
                resultSpan.textContent = `🚫 Error`;
            }
        }

        async function testAllEndpoints() {
            const endpoints = [
                ['health', 'https://api.snapitforms.com/health', 'GET'],
                ['auth', 'https://api.snapitforms.com/auth/google', 'POST'],
                ['create-form', 'https://api.snapitforms.com/forms', 'POST'],
                ['get-forms', 'https://api.snapitforms.com/forms', 'GET'],
                ['submit', 'https://api.snapitforms.com/submit', 'POST'],
                ['stripe', 'https://api.snapitforms.com/create-checkout-session', 'POST']
            ];

            for (const [name, url, method] of endpoints) {
                await testEndpoint(name, url, method);
                await new Promise(resolve => setTimeout(resolve, 500)); // Rate limiting
            }
        }

        // Form Testing
        function testFormCreation() {
            const result = document.getElementById('form-test-result');
            result.className = 'result info';
            result.textContent = 'Testing form creation...\nThis would create a test form with various field types.';
        }

        function testFormSubmission() {
            const result = document.getElementById('form-test-result');
            result.className = 'result info';
            result.textContent = 'Testing form submission...\nThis would submit test data to a form endpoint.';
        }

        // Stripe Testing
        function testStripeCheckout() {
            const tier = document.getElementById('pricing-tier').value;
            const result = document.getElementById('stripe-test-result');
            result.className = 'result info';
            result.textContent = `Testing Stripe checkout for ${tier} tier...\nAccount ID: acct_1RUcFYEpdWEENcj1\nThis would redirect to Stripe checkout in production.`;
        }

        // Performance Testing
        async function performanceTest() {
            const result = document.getElementById('performance-result');
            result.className = 'result info';
            result.textContent = 'Running performance test...';

            const tests = [];
            for (let i = 0; i < 5; i++) {
                const startTime = Date.now();
                try {
                    await fetch('https://api.snapitforms.com/health');
                    tests.push(Date.now() - startTime);
                } catch (error) {
                    tests.push('failed');
                }
            }

            const avgTime = tests.filter(t => typeof t === 'number').reduce((a, b) => a + b, 0) / tests.length || 0;
            result.textContent = `Performance Test Results:\nAverage Response Time: ${avgTime.toFixed(2)}ms\nTests: ${tests.join('ms, ')}ms\nReliability: ${tests.filter(t => typeof t === 'number').length}/5 successful`;
        }

        // Generate Complete Report
        function generateReport() {
            const report = document.getElementById('diagnostic-report');
            report.className = 'result info';

            let reportText = '=== SNAPIT FORMS DIAGNOSTIC REPORT ===\n\n';
            reportText += `Timestamp: ${new Date().toISOString()}\n`;
            reportText += `Domain: snapitforms.com\n`;
            reportText += `API: api.snapitforms.com\n\n`;

            reportText += '--- ENDPOINT TEST RESULTS ---\n';
            for (const [name, result] of Object.entries(testResults)) {
                reportText += `${name.toUpperCase()}:\n`;
                reportText += `  URL: ${result.url}\n`;
                reportText += `  Method: ${result.method}\n`;
                reportText += `  Status: ${result.status || 'Error'}\n`;
                reportText += `  Response Time: ${result.responseTime || 'N/A'}ms\n`;
                reportText += `  Success: ${result.success ? 'YES' : 'NO'}\n`;
                if (result.error) reportText += `  Error: ${result.error}\n`;
                reportText += '\n';
            }

            reportText += '--- RECOMMENDATIONS ---\n';
            const failedTests = Object.values(testResults).filter(r => !r.success);
            if (failedTests.length === 0) {
                reportText += '✅ All tests passed! System appears to be functioning correctly.\n';
            } else {
                reportText += `⚠️ ${failedTests.length} tests failed. Review API configuration.\n`;
            }

            report.textContent = reportText;
        }

        // Initialize on page load
        window.onload = function() {
            testSystemStatus();
        };
    </script>
</body>
</html>